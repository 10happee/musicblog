<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Live Blog</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet"/>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #111;
      color: white;
      margin: 0;
      padding: 0;
    }
    .hidden {
      display: none;
    }
    #username-screen {
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: #111;
    }
    input, textarea {
      width: 100%;
      max-width: 300px;
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      border: none;
      font-size: 1rem;
    }
    button {
      padding: 10px 20px;
      margin-top: 10px;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      background-color: #4f46e5;
      color: white;
      cursor: pointer;
    }
    #blog-app {
      padding: 20px;
    }
    #add-post-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      font-size: 24px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: #38bdf8;
    }
    #post-form {
      background: #1a1a1a;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    #posts-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .post {
      background: #1e1e1e;
      padding: 15px;
      border-radius: 10px;
    }
    .post h3 {
      margin: 0 0 10px;
      color: #60a5fa;
    }
    .comments {
      margin-top: 10px;
      border-left: 2px solid #333;
      padding-left: 10px;
    }
    .comment {
      margin-top: 5px;
    }
    .comment strong {
      color: #4fd1c5;
    }
  </style>
</head>
<body>

<!-- Username screen -->
<div id="username-screen">
  <h2>Enter your username</h2>
  <input type="text" id="username-input" placeholder="Your name">
  <button id="continue-btn">Continue</button>
</div>

<!-- Blog app screen -->
<div id="blog-app" class="hidden">
  <div id="post-form" class="hidden">
    <input type="text" id="post-title" placeholder="Post Title">
    <textarea id="post-desc" rows="4" placeholder="Post Description"></textarea>
    <button onclick="submitPost()">Post</button>
  </div>

  <div id="posts-container"></div>
</div>

<!-- Add Post Button -->
<button id="add-post-btn" class="hidden">+</button>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<script>
  // Firebase setup
  const firebaseConfig = {
    apiKey: "AIzaSyDErOzCKFceg7Jzci80jTVJT5tVcsRKb4E",
    authDomain: "happeemusicblog.firebaseapp.com",
    databaseURL: "https://happeemusicblog-default-rtdb.firebaseio.com",
    projectId: "happeemusicblog",
    storageBucket: "happeemusicblog.firebasestorage.app",
    messagingSenderId: "452113598802",
    appId: "1:452113598802:web:334fd95fadfe4bbd16d28b",
    measurementId: "G-MRJ6M3B5FG"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let username = "";

  document.getElementById("continue-btn").addEventListener("click", () => {
    const input = document.getElementById("username-input").value.trim();
    if (!input) return;

    username = input;

    document.getElementById("username-screen").classList.add("hidden");
    document.getElementById("blog-app").classList.remove("hidden");
    document.getElementById("add-post-btn").classList.remove("hidden");

    loadPosts();
  });

  document.getElementById("add-post-btn").addEventListener("click", () => {
    const form = document.getElementById("post-form");
    form.classList.toggle("hidden");
  });

  function submitPost() {
    const title = document.getElementById("post-title").value.trim();
    const desc = document.getElementById("post-desc").value.trim();
    if (!title || !desc) return;

    const postRef = db.ref("posts/" + Date.now());
    postRef.set({
      title,
      description: desc,
      username,
      timestamp: Date.now()
    });

    document.getElementById("post-title").value = "";
    document.getElementById("post-desc").value = "";
    document.getElementById("post-form").classList.add("hidden");
  }

  function loadPosts() {
    const postsRef = db.ref("posts");
    postsRef.on("value", (snapshot) => {
      const postsContainer = document.getElementById("posts-container");
      postsContainer.innerHTML = "";
      const data = snapshot.val();
      if (!data) return;

      const keys = Object.keys(data).sort((a, b) => b - a);
      keys.forEach((key) => {
        const post = data[key];
        const div = document.createElement("div");
        div.className = "post";

        const time = new Date(post.timestamp).toLocaleString();
        div.innerHTML = `
          <h3>${post.title}</h3>
          <p>${post.description}</p>
          <small>By ${post.username} at ${time}</small>
          <div class="comments" id="comments-${key}"></div>
          <input type="text" placeholder="Add a comment..." id="comment-input-${key}">
          <button onclick="addComment('${key}')">Comment</button>
        `;
        postsContainer.appendChild(div);
        loadComments(key);
      });
    });
  }

  function addComment(postId) {
    const input = document.getElementById("comment-input-" + postId);
    const text = input.value.trim();
    if (!text) return;

    db.ref("comments/" + postId).push({
      text,
      username,
      timestamp: Date.now()
    });

    input.value = "";
  }

  function loadComments(postId) {
    const ref = db.ref("comments/" + postId);
    ref.on("value", (snapshot) => {
      const commentsDiv = document.getElementById("comments-" + postId);
      commentsDiv.innerHTML = "";
      const data = snapshot.val();
      if (!data) return;

      Object.values(data).forEach(comment => {
        const div = document.createElement("div");
        div.className = "comment";
        div.innerHTML = `<strong>${comment.username}</strong>: ${comment.text}`;
        commentsDiv.appendChild(div);
      });
    });
  }
</script>

</body>
</html>
